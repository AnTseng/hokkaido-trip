<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŒ—æµ·é“å†¬æ—… 2025</title>
    
    <!-- PWA Settings -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#f7f6f2">
    <link rel="apple-touch-icon" href="icon.png"> <!-- ç¨å¾Œèªªæ˜ icon -->

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f7f6f2;
            color: #2d3436;
            -webkit-tap-highlight-color: transparent;
            /* iOS Safe Area handling */
            padding-bottom: env(safe-area-inset-bottom);
        }
        .japanese-shadow { box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .nav-active { color: #b91c1c; font-weight: 700; }
        .tag-transport { background-color: #e0f2fe; color: #0369a1; }
        .tag-food { background-color: #ffedd5; color: #c2410c; }
        .tag-sight { background-color: #dcfce7; color: #15803d; }
        .tag-stay { background-color: #f3e8ff; color: #7e22ce; }
        html { scroll-behavior: smooth; }
        .ai-tip {
            border-left: 3px solid #b91c1c;
            background: #fff5f5;
            padding: 8px 12px;
            font-size: 0.85rem;
            color: #555;
            margin-top: 8px;
        }
    </style>
</head>
<body x-data="tripApp()">

    <!-- Header -->
    <header class="fixed top-0 w-full z-50 bg-[#f7f6f2]/95 backdrop-blur-md border-b border-gray-200 pt-10 pb-4 px-4 shadow-sm">
        <div class="flex justify-between items-end">
            <div>
                <h2 class="text-xs text-gray-500 tracking-widest uppercase">HOKKAIDO 2025</h2>
                <h1 class="text-2xl font-bold text-gray-800">å†¬ã®æ—…</h1>
            </div>
            <div class="text-right">
                <span class="text-xs bg-gray-200 px-2 py-1 rounded-full text-gray-600">12/20 - 12/28</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="pt-28 pb-24 px-4 min-h-screen">
        
         <!-- VIEW: ITINERARY -->
        <div x-show="currentTab === 'itinerary'" x-transition.opacity>
            <template x-for="(day, index) in itinerary" :key="index">
                <div class="mb-8">
                    <!-- Date Header -->
                    <div class="flex items-center justify-between mb-4 sticky top-24 z-10 bg-[#f7f6f2] py-2">
                        <div class="flex items-baseline gap-2">
                            <span class="text-3xl font-bold text-[#b91c1c]" x-text="day.dateStr"></span>
                            <span class="text-sm font-medium text-gray-400" x-text="day.weekday"></span>
                        </div>
                        <div class="flex items-center gap-2 text-xs text-gray-500 bg-white px-3 py-1 rounded-full shadow-sm">
                            <i :class="day.weatherIcon"></i>
                            <span x-text="day.temp"></span>
                        </div>
                    </div>
                    <div class="text-xs text-gray-400 mb-2 pl-1" x-text="day.route"></div>

                    <!-- Events -->
                    <div class="space-y-4">
                        <template x-for="event in day.events" :key="event.id">
                            <div class="bg-white p-4 rounded-xl japanese-shadow relative border-l-4" 
                                 :class="{
                                    'border-blue-400': event.type === 'transport',
                                    'border-orange-400': event.type === 'food',
                                    'border-green-400': event.type === 'sight',
                                    'border-purple-400': event.type === 'stay'
                                 }">
                                
                                <!-- Time & Tag -->
                                <div class="flex justify-between items-start mb-2">
                                    <span class="text-xs font-mono font-bold text-gray-400" x-text="event.time"></span>
                                    <span class="text-[10px] px-2 py-0.5 rounded font-bold uppercase tracking-wide"
                                          :class="{
                                            'tag-transport': event.type === 'transport',
                                            'tag-food': event.type === 'food',
                                            'tag-sight': event.type === 'sight',
                                            'tag-stay': event.type === 'stay'
                                          }" x-text="event.typeLabel"></span>
                                </div>

                                <!-- Title -->
                                <h3 class="text-lg font-bold text-gray-800 leading-tight mb-1" x-text="event.title"></h3>
                                <p x-show="event.desc" class="text-sm text-gray-500 mb-2" x-text="event.desc"></p>

                                <!-- AI Tour Guide Tips -->
                                <div x-show="event.tips" class="ai-tip rounded-md">
                                    <div class="flex items-start gap-2">
                                        <i class="fa-solid fa-lightbulb text-yellow-500 mt-1"></i>
                                        <div>
                                            <span class="font-bold text-[#b91c1c] text-xs block mb-0.5">TRAVEL TIP</span>
                                            <span x-html="event.tips"></span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Action Buttons -->
                                <div class="mt-3 flex gap-2">
                                    <a :href="event.mapUrl" target="_blank" class="flex-1 bg-gray-50 hover:bg-gray-100 text-gray-700 text-xs font-bold py-2 rounded-lg text-center transition flex items-center justify-center gap-1 border border-gray-200">
                                        <i class="fa-solid fa-location-arrow text-blue-500"></i> å°èˆª
                                    </a>
                                    <button x-show="event.link" @click="window.open(event.link)" class="px-3 bg-gray-50 hover:bg-gray-100 text-gray-700 text-xs font-bold py-2 rounded-lg border border-gray-200">
                                        <i class="fa-solid fa-circle-info"></i>
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </template>
        </div>

        <!-- VIEW: INFO (Flights & Hotels) -->
        <div x-show="currentTab === 'info'" x-transition.opacity class="space-y-6">
            
            <!-- Hotels Card -->
            <div class="bg-white rounded-xl japanese-shadow p-5">
                <h3 class="text-lg font-bold mb-4 border-b pb-2">ğŸ¨ ä½å®¿è³‡è¨Š</h3>
                <div class="space-y-4">
                    <div class="pb-3 border-b border-gray-100 last:border-0">
                        <div class="text-xs text-gray-400">Day 1-3 (æ—­å·)</div>
                        <div class="font-bold text-gray-800">OMO7 æ—­å· (æ˜Ÿé‡é›†åœ˜)</div>
                        <a href="https://goo.gl/maps/AsahikawaOMO7" target="_blank" class="text-xs text-blue-500 underline mt-1 block">æŸ¥çœ‹åœ°åœ–</a>
                    </div>
                    <div class="pb-3 border-b border-gray-100 last:border-0">
                        <div class="text-xs text-gray-400">Day 3-5 (å‡½é¤¨)</div>
                        <div class="font-bold text-gray-800">å‡½é¤¨ JR Inn</div>
                        <div class="text-xs text-gray-500">ä½æ–¼è»Šç«™æ—ï¼Œäº¤é€šä¾¿åˆ©</div>
                         <a href="https://goo.gl/maps/HakodateJRInn" target="_blank" class="text-xs text-blue-500 underline mt-1 block">æŸ¥çœ‹åœ°åœ–</a>
                    </div>
                    <div class="pb-3 border-b border-gray-100 last:border-0">
                        <div class="text-xs text-gray-400">Day 5-9 (æœ­å¹Œ)</div>
                        <div class="font-bold text-gray-800">æœ­å¹Œäº¬ç‹å»£å ´é£¯åº—</div>
                         <a href="https://goo.gl/maps/KeioPlazaSapporo" target="_blank" class="text-xs text-blue-500 underline mt-1 block">æŸ¥çœ‹åœ°åœ–</a>
                    </div>
                </div>
            </div>

            <!-- Flights Card -->
            <div class="bg-white rounded-xl japanese-shadow p-5">
                <h3 class="text-lg font-bold mb-4 border-b pb-2">âœˆï¸ èˆªç­è³‡è¨Š</h3>
                <div class="flex justify-between items-center mb-4">
                    <div class="text-center">
                        <div class="text-2xl font-bold">TPE</div>
                        <div class="text-xs text-gray-500">06:15</div>
                    </div>
                    <div class="text-xs text-gray-400 flex flex-col items-center">
                        <span>BR166</span>
                        <i class="fa-solid fa-plane text-gray-300 my-1"></i>
                        <span>3h 45m</span>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold">CTS</div>
                        <div class="text-xs text-gray-500">11:00</div>
                    </div>
                </div>
                <div class="flex justify-between items-center">
                    <div class="text-center">
                        <div class="text-2xl font-bold">CTS</div>
                        <div class="text-xs text-gray-500">15:20</div>
                    </div>
                    <div class="text-xs text-gray-400 flex flex-col items-center">
                        <span>BR115</span>
                        <i class="fa-solid fa-plane text-gray-300 my-1 transform rotate-180"></i>
                        <span>4h 45m</span>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold">TPE</div>
                        <div class="text-xs text-gray-500">19:05</div>
                    </div>
                </div>
            </div>

            <!-- Emergency -->
            <div class="bg-red-50 rounded-xl p-5 border border-red-100">
                <h3 class="text-lg font-bold text-red-800 mb-2">ğŸ†˜ ç·Šæ€¥è¯çµ¡</h3>
                <ul class="text-sm text-red-700 space-y-1">
                    <li>è­¦å¯Ÿå±€: 110</li>
                    <li>ç«è­¦/æ•‘è­·è»Š: 119</li>
                    <li>å¤–äº¤éƒ¨æ—…å¤–æ•‘åŠ©: +81-80-1009-7179</li>
                </ul>
            </div>
        </div>

        <!-- VIEW: BUDGET (å·²é€£æ¥ Firebase) -->
        <div x-show="currentTab === 'budget'" x-transition.opacity>
            <div class="bg-white rounded-xl japanese-shadow p-5 mb-6">
                <h3 class="text-gray-500 text-sm mb-1">ç¸½æ”¯å‡º (æ—¥å¹£)</h3>
                <!-- Show Loading state if connecting -->
                <div x-show="loading" class="text-sm text-gray-400">åŒæ­¥ä¸­...</div>
                <div x-show="!loading" class="text-4xl font-bold text-gray-800">Â¥<span x-text="totalExpense"></span></div>
            </div>

            <div class="bg-white rounded-xl japanese-shadow p-5 mb-6">
                <h4 class="font-bold mb-3 text-sm text-gray-600">æ–°å¢è¨˜å¸³</h4>
                <div class="flex gap-2 mb-2">
                    <input type="text" x-model="newItemName" placeholder="é …ç›®" class="w-2/3 bg-gray-50 border-0 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-200">
                    <input type="number" x-model="newItemCost" placeholder="Â¥" class="w-1/3 bg-gray-50 border-0 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-200">
                </div>
                <button @click="addExpense()" class="w-full bg-[#2d3748] text-white py-3 rounded-lg font-bold text-sm hover:bg-gray-700 transition">æ–°å¢</button>
            </div>

            <div class="space-y-2 pb-20">
                <template x-for="item in expenses" :key="item.id">
                    <div class="flex justify-between items-center bg-white p-3 rounded-lg border border-gray-100">
                        <span class="text-gray-700" x-text="item.name"></span>
                        <div class="flex items-center gap-3">
                            <span class="font-mono font-bold" x-text="'Â¥' + item.cost"></span>
                            <button @click="removeExpense(item.id)" class="text-gray-300 hover:text-red-500"><i class="fa-solid fa-trash-can"></i></button>
                        </div>
                    </div>
                </template>
            </div>
        </div>

    </main>

    <!-- Bottom Nav -->
    <nav class="fixed bottom-0 w-full bg-white border-t border-gray-200 pb-safe pt-2 px-6 z-50 flex justify-between items-center pb-6">
        <button @click="currentTab = 'itinerary'" class="flex flex-col items-center gap-1 w-16 transition" :class="currentTab === 'itinerary' ? 'nav-active' : 'text-gray-400'"><i class="fa-solid fa-map"></i><span class="text-[10px]">è¡Œç¨‹</span></button>
        <button @click="currentTab = 'info'" class="flex flex-col items-center gap-1 w-16 transition" :class="currentTab === 'info' ? 'nav-active' : 'text-gray-400'"><i class="fa-solid fa-suitcase"></i><span class="text-[10px]">è³‡è¨Š</span></button>
        <button @click="currentTab = 'budget'" class="flex flex-col items-center gap-1 w-16 transition" :class="currentTab === 'budget' ? 'nav-active' : 'text-gray-400'"><i class="fa-solid fa-yen-sign"></i><span class="text-[10px]">è¨˜å¸³</span></button>
    </nav>

    <!-- Scripts: Alpine + Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import Alpine from 'https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/module.esm.js';

        // âš ï¸ã€è«‹å¡«å…¥æ‚¨çš„ Firebase Configã€‘âš ï¸
        const firebaseConfig = {
            apiKey: "AIzaSyCNilQq3XGVLnlorZsi0blt0-9y73ctPq0",
            authDomain: "hokkaido-trip-2025-7d81b.firebaseapp.com",
            projectId: "hokkaido-trip-2025-7d81b",
            storageBucket: "hokkaido-trip-2025-7d81b.firebasestorage.app",
            messagingSenderId: "465206983896",
            appId: "1:465206983896:web:70ccec37a4c215f15fabad",
            measurementId: "G-2HQ49JQ0PK"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const expensesCol = collection(db, "expenses");

        // Alpine Data Logic
        document.addEventListener('alpine:init', () => {
            Alpine.data('tripApp', () => ({
                currentTab: 'itinerary',
                newItemName: '',
                newItemCost: '',
                expenses: [],
                loading: true,
                itinerary: [
                    {
                        dateStr: "12/20", weekday: "Sat", route: "å°åŒ— â” æ—­å·",
                        temp: "-4Â°C / -1Â°C", weatherIcon: "fa-solid fa-snowflake text-blue-300",
                        events: [
                            { id: 1, time: "06:15", type: "transport", typeLabel: "Flight", title: "BR166 é£›å¾€æœ­å¹Œ", desc: "æ¡ƒåœ’æ©Ÿå ´ T2 -> æ–°åƒæ­²æ©Ÿå ´", mapUrl: "https://goo.gl/maps/TPE" },
                            { id: 2, time: "11:00", type: "transport", typeLabel: "å…¥å¢ƒ", title: "æŠµé”æ–°åƒæ­²æ©Ÿå ´", desc: "é ˜å– JR Pass / æ›åŒ¯", mapUrl: "https://goo.gl/maps/CTS" },
                            { id: 3, time: "14:00", type: "transport", typeLabel: "JR", title: "å‰å¾€æ—­å·", desc: "JR Kamui / Lilac è™Ÿ (ç´„ 1.5hr)", mapUrl: "https://goo.gl/maps/CTS", tips: "è¨˜å¾—åœ¨æ©Ÿå ´è²·ä¸€äº›é£¯ç³°æˆ–ä¾¿ç•¶åœ¨è»Šä¸Šåƒã€‚" },
                            { id: 4, time: "16:00", type: "stay", typeLabel: "Check-in", title: "OMO7 æ—­å·", desc: "æ˜Ÿé‡é›†åœ˜éƒ½å¸‚è§€å…‰é£¯åº—", mapUrl: "https://goo.gl/maps/AsahikawaOMO7", tips: "é£¯åº—æœ‰å…è²»çš„ã€Go-KINJOã€åœ°åœ–ï¼Œè¨˜å¾—ç´¢å–å‘¨é‚Šç¾é£ŸæŒ‡å—ã€‚" },
                            { id: 5, time: "18:00", type: "food", typeLabel: "æ™šé¤", title: "æˆå‰æ€æ±—å¤§é»‘å±‹ æœ¬åº—", desc: "éœ€ç¾å ´æ’éšŠ", mapUrl: "https://maps.app.goo.gl/daikokuya", tips: "å¿…é»ï¼š<b>ç”Ÿç¾Šè‚‰ (Namaramu)</b> å’Œ <b>å¸¶éª¨ç¾Šæ’</b>ã€‚å»ºè­° 16:30 å°±å»æ’éšŠï¼Œä¸ç„¶æœƒç­‰å¾ˆä¹…ï¼" },
                        ]
                    },
                    {
                        dateStr: "12/21", weekday: "Sun", route: "æ—­å· (æ»‘é›ªæ—¥)",
                        temp: "-6Â°C / -2Â°C", weatherIcon: "fa-solid fa-snowflake text-blue-300",
                        events: [
                            { id: 21, time: "07:50", type: "transport", typeLabel: "Bus", title: "æ¥é§å·´å£«å¾€ç¥å±…", desc: "OMO7 é–€å£ä¸Šè»Š", mapUrl: "https://goo.gl/maps/AsahikawaOMO7", tips: "è«‹ç¢ºèªå‰ä¸€å¤©æ˜¯å¦å·²é ç´„å·´å£« (22:00å‰)ã€‚" },
                            { id: 22, time: "09:00", type: "sight", typeLabel: "Ski", title: "ç¥å±…æ»‘é›ªå ´ (Kamui)", desc: "å…¨æ—¥æ»‘é›ª / æ•™ç·´èª² 9:30 é–‹å§‹", mapUrl: "https://maps.app.goo.gl/KamuiSkiLinks" },
                            { id: 23, time: "15:50", type: "transport", typeLabel: "Bus", title: "è¿”å›å¸‚å€", desc: "æ­ä¹˜è¿”ç¨‹æ¥é§è»Š", mapUrl: "" },
                            { id: 24, time: "17:00", type: "food", typeLabel: "Coffee", title: "çˆç²äº­ Chiroru", desc: "å¾©å¤å–«èŒ¶åº—", mapUrl: "https://maps.app.goo.gl/Chiroru", tips: "æ¨è–¦ï¼š<b>æ‹›ç‰Œé¬†é¤…</b>ï¼Œéå¸¸æœ‰æ˜­å’Œé¢¨æƒ…çš„è€åº—ã€‚" },
                            { id: 25, time: "19:00", type: "food", typeLabel: "æ™šé¤", title: "æ¢…å…‰è»’ æ‹‰éºµ", desc: "æ—­å·é†¬æ²¹æ‹‰éºµä»£è¡¨", mapUrl: "https://maps.app.goo.gl/Baikohken", tips: "å¿…é»ï¼š<b>é†¬æ²¹å¥¶æ²¹ç‰ç±³æ‹‰éºµ</b>ï¼Œæ¿ƒéƒæš–èº«ã€‚" }
                        ]
                    },
                    {
                        dateStr: "12/22", weekday: "Mon", route: "æ—­å· â” å‡½é¤¨",
                        temp: "-3Â°C / 0Â°C", weatherIcon: "fa-solid fa-cloud text-gray-400",
                        events: [
                            { id: 31, time: "08:00", type: "sight", typeLabel: "Ski", title: "ç¥å±…æ»‘é›ªå ´ (Day 2)", desc: "äº«å—æœ€å¾Œæ»‘é›ªæ™‚å…‰", mapUrl: "https://maps.app.goo.gl/KamuiSkiLinks" },
                            { id: 32, time: "17:00", type: "transport", typeLabel: "JR", title: "ç§»å‹•ï¼šæ—­å· -> æœ­å¹Œ", desc: "Ltd. Exp. Lilac", mapUrl: "" },
                            { id: 33, time: "18:46", type: "transport", typeLabel: "JR", title: "ç§»å‹•ï¼šæœ­å¹Œ -> å‡½é¤¨", desc: "Ltd. Exp. Hokuto (ç´„ 3.5hr)", mapUrl: "", tips: "è»Šç¨‹å¾ˆé•·ï¼Œå‹™å¿…åœ¨æœ­å¹Œç«™è²·è‘—åçš„<b>ã€æµ·é®®ä¾¿ç•¶ã€</b>æˆ–<b>ã€çŸ³ç‹©é®­é­šä¾¿ç•¶ã€</b>ä¸Šè»Šåƒã€‚" },
                            { id: 34, time: "22:30", type: "stay", typeLabel: "Hotel", title: "å‡½é¤¨ JR Inn", desc: "Check-in / ä¼‘æ¯", mapUrl: "https://maps.app.goo.gl/HakodateJRInn" },
                            { id: 35, time: "22:40", type: "food", typeLabel: "å®µå¤œ", title: "å’Œé…’ è§’æ‰“ ã†ãˆç”°èˆ", desc: "å–ä¸€æ¯æš–æš–èº«", mapUrl: "https://maps.app.goo.gl/Uedas", tips: "å°ˆè³£åŒ—æµ·é“åœ°é…’ï¼Œé©åˆå°é…Œã€‚" }
                        ]
                    },
                    {
                        dateStr: "12/23", weekday: "Tue", route: "å‡½é¤¨ä¸€æ—¥éŠ",
                        temp: "-1Â°C / 2Â°C", weatherIcon: "fa-solid fa-sun text-yellow-500",
                        events: [
                            { id: 41, time: "08:00", type: "food", typeLabel: "æ—©é¤", title: "å‡½é¤¨æœå¸‚", desc: "é‡£çƒè³Š / æµ·é®®ä¸¼", mapUrl: "https://maps.app.goo.gl/HakodateMorningMarket", tips: "å¿…è©¦ï¼š<b>é‡£æ´»çƒè³Š</b>ï¼Œç¾é‡£ç¾æ®ºéå¸¸é®®ç”œï¼" },
                            { id: 42, time: "10:00", type: "sight", typeLabel: "æ™¯é»", title: "äº”ç¨œéƒ­å…¬åœ’", desc: "ç™»ä¸Šå¡”å°çœ‹æ˜Ÿå½¢å ¡å£˜", mapUrl: "https://maps.app.goo.gl/Goryokaku" },
                            { id: 43, time: "12:00", type: "food", typeLabel: "åˆé¤", title: "å¹¸é‹å°ä¸‘æ¼¢å ¡", desc: "äº”ç¨œéƒ­å‰åº—", mapUrl: "https://maps.app.goo.gl/LuckyPierrot", tips: "å¿…é»ï¼š<b>ä¸­è¯é›è…¿æ¼¢å ¡ (Chinese Chicken Burger)</b> Set No.1ã€‚ä»½é‡å¾ˆå¤§ï¼" },
                            { id: 44, time: "14:00", type: "sight", typeLabel: "æ•£æ­¥", title: "é‡‘æ£®ç´…ç£šå€‰åº« & å…«å¹¡å‚", desc: "æ¸¯ç£ç¾æ™¯ / çŸ¥åæ–œå¡", mapUrl: "https://maps.app.goo.gl/Kanemori", tips: "å…«å¹¡å‚æ˜¯æ—¥åŠ‡åå ´æ™¯ï¼Œå¾å¡é ‚å¾€ä¸‹æ‹å¯ä»¥çœ‹åˆ°æµ·ã€‚" },
                            { id: 45, time: "16:00", type: "sight", typeLabel: "å¤œæ™¯", title: "å‡½é¤¨å±±çºœè»Š", desc: "ç™¾è¬å¤œæ™¯ (éœ€ææ—©ä¸Šå±±å¡ä½)", mapUrl: "https://maps.app.goo.gl/MtHakodate", tips: "æ—¥è½æ™‚é–“ç´„ 16:10ï¼Œå»ºè­° 15:30 å°±å»æ’çºœè»Šï¼Œäººæ½®éå¸¸å¤šã€‚" },
                            { id: 46, time: "19:00", type: "food", typeLabel: "æ™šé¤", title: "Nebokke (æ ¹ã¼ã£ã‘)", desc: "å±…é…’å±‹ / çƒ¤é­š", mapUrl: "https://maps.app.goo.gl/Nebokke", tips: "æ‹›ç‰Œæ˜¯<b>çƒ¤èŠ±é¯½é­š (Hokke)</b>ï¼Œè‚‰è³ªéå¸¸åšå¯¦ã€‚" }
                        ]
                    },
                    {
                        dateStr: "12/24", weekday: "Wed", route: "å‡½é¤¨ â” æœ­å¹Œ",
                        temp: "-2Â°C / 1Â°C", weatherIcon: "fa-solid fa-cloud-meatball text-gray-300",
                        events: [
                            { id: 51, time: "10:05", type: "transport", typeLabel: "JR", title: "å‰å¾€å¤§æ²¼å…¬åœ’", desc: "Hokuto 7 è™Ÿ", mapUrl: "" },
                            { id: 52, time: "11:00", type: "sight", typeLabel: "æ™¯é»", title: "å¤§æ²¼åœ‹å®šå…¬åœ’", desc: "é›ªæ™¯ / çµå†°æ¹–é¢", mapUrl: "https://maps.app.goo.gl/OnumaPark", tips: "è‘—åçš„ã€åƒä¹‹é¢¨ã€èª•ç”Ÿåœ°ï¼Œé©åˆè²·<b>ã€æ²¼ä¹‹å®¶ã€</b>çš„é†¬æ²¹ç´…è±†ç³°å­ç•¶é»å¿ƒã€‚" },
                            { id: 53, time: "14:00", type: "transport", typeLabel: "JR", title: "å‰å¾€æœ­å¹Œ", desc: "Hokuto 13 è™Ÿ", mapUrl: "" },
                            { id: 54, time: "17:30", type: "sight", typeLabel: "Event", title: "å¤§é€šå…¬åœ’ è–èª•å¸‚é›†", desc: "æ…•å°¼é»‘è–èª•å¸‚é›† & ç‡ˆé£¾", mapUrl: "https://maps.app.goo.gl/OdoriPark", tips: "å¹³å®‰å¤œæ°£æ°›æœ€æ¿ƒåšçš„åœ°æ–¹ï¼è¨˜å¾—è²·ä¸€æ¯<b>ç†±ç´…é…’</b>æš–èº«ã€‚" },
                            { id: 55, time: "19:00", type: "food", typeLabel: "æ™šé¤", title: "æœ­å¹Œæ‹‰éºµ", desc: "è–„é‡å‘¨é‚Š (ä¿¡ç„/ç©º/é›ªé¢¨)", mapUrl: "https://goo.gl/maps/SapporoRamenAlley", tips: "è‹¥æ’ä¸åˆ°ååº—ï¼Œæ‹‰éºµæ©«ä¸å…§ä¹Ÿæœ‰å¾ˆå¤šä¸éŒ¯çš„é¸æ“‡ã€‚" }
                        ]
                    },
                    {
                        dateStr: "12/25", weekday: "Thu", route: "æœ­å¹Œ â†” å°æ¨½",
                        temp: "-3Â°C / 0Â°C", weatherIcon: "fa-solid fa-snowflake text-blue-300",
                        events: [
                            { id: 61, time: "08:00", type: "food", typeLabel: "æ—©é¤", title: "å ´å¤–å¸‚å ´", desc: "æµ·é®®ä¸¼", mapUrl: "https://maps.app.goo.gl/OuterMarket" },
                            { id: 62, time: "10:00", type: "transport", typeLabel: "JR", title: "å‰å¾€å°æ¨½", desc: "å¿«é€Ÿ Airport è™Ÿ", mapUrl: "", tips: "å»ºè­°åå³å´åº§ä½ï¼Œå¯ä»¥çœ‹åˆ°æµ·ã€‚" },
                            { id: 63, time: "11:30", type: "food", typeLabel: "åˆé¤", title: "å®ã™ã— (Takasushi)", desc: "å£½å¸ååº—", mapUrl: "https://maps.app.goo.gl/Takasushi", tips: "å»ºè­°äº‹å…ˆè«‹é£¯åº—æ«ƒæª¯å¹«å¿™é›»è©±é ç´„ã€‚" },
                            { id: 64, time: "13:00", type: "sight", typeLabel: "æ•£æ­¥", title: "å°æ¨½é‹æ²³ & å ºç”ºé€š", desc: "ç»ç’ƒé¤¨ / éŸ³æ¨‚ç›’å ‚", mapUrl: "https://maps.app.goo.gl/OtaruCanal", tips: "å¿…è²·ä¼´æ‰‹ç¦®ï¼š<b>LeTAO é›™å±¤èµ·å¸è›‹ç³•</b>ã€<b>åŒ—æœæ¨“ å¦–ç²¾ä¹‹æ£®å¹´è¼ªè›‹ç³•</b>ã€<b>å…­èŠ±äº­ èŠå§†è‘¡è„å¤¾å¿ƒé¤…ä¹¾</b>ã€‚" },
                            { id: 65, time: "15:00", type: "food", typeLabel: "ç”œé»", title: "Un dÃ©lice", desc: "å¸ƒä¸å¤§ç¦", mapUrl: "https://maps.app.goo.gl/Undelice" },
                            { id: 66, time: "16:00", type: "sight", typeLabel: "å¤œæ™¯", title: "å¤©ç‹—å±±çºœè»Š", desc: "æƒ…æ›¸é›»å½±å ´æ™¯", mapUrl: "https://maps.app.goo.gl/Tenguyama" },
                            { id: 67, time: "19:00", type: "food", typeLabel: "æ™šé¤", title: "æ¹¯å’–å“©", desc: "Suage+ æˆ– Samurai", mapUrl: "https://maps.app.goo.gl/Suage", tips: "æ¹¯å’–å“©è¨˜å¾—è¦åŠ é»ã€èµ·å¸é£¯ã€(Cheese on Rice)ã€‚" },
                            { id: 68, time: "21:00", type: "food", typeLabel: "ç”œé»", title: "GELATERIA La Giostra", desc: "æ·±å¤œç¾©å¼å†°æ·‡æ·‹", mapUrl: "https://maps.app.goo.gl/LaGiostra", tips: "é€±äº”é€±å…­æ‰é–‹åˆ°å‡Œæ™¨ï¼ŒæŠŠæ¡æ©Ÿæœƒï¼" }
                        ]
                    },
                    {
                        dateStr: "12/26", weekday: "Fri", route: "æœ­å¹Œå¸‚å€ / éƒŠå€",
                        temp: "-2Â°C / 1Â°C", weatherIcon: "fa-solid fa-cloud text-gray-400",
                        events: [
                            { id: 71, time: "08:00", type: "food", typeLabel: "æ—©é¤", title: "äºŒæ¢å¸‚å ´", desc: "å¸‚å€æµ·é®®", mapUrl: "https://maps.app.goo.gl/NijoMarket" },
                            { id: 72, time: "09:00", type: "sight", typeLabel: "æ™¯é»", title: "åŒ—æµ·é“å¤§å­¸", desc: "ç™½æ¥Šæœ¨æ—é“", mapUrl: "https://maps.app.goo.gl/HokkaidoUniv" },
                            { id: 73, time: "10:30", type: "sight", typeLabel: "éƒŠå€", title: "åœ‹ç‡Ÿç€§é‡éˆ´è˜­ä¸˜é™µå…¬åœ’", desc: "æˆ¶å¤–é›ªä¸Šæ´»å‹•", mapUrl: "https://maps.app.goo.gl/TakinoSuzuran", tips: "é€™è£¡æœ‰è¶…é•·é›ªèƒæºœæ»‘æ¢¯ï¼Œéå¸¸å¥½ç©ï¼å»ºè­°æ­åœ°éµåˆ°çœŸé§’å…§ç«™è½‰å·´å£«ã€‚" },
                            { id: 74, time: "14:00", type: "sight", typeLabel: "æ™¯é»", title: "é ­å¤§ä½›æ®¿ (Hill of the Buddha)", desc: "å®‰è—¤å¿ é›„è¨­è¨ˆ", mapUrl: "https://maps.app.goo.gl/GreatBuddha", tips: "éå¸¸èŠåš´ä¸”é©åˆæ‹ç…§çš„å»ºç¯‰å¥‡è§€ã€‚" },
                            { id: 75, time: "16:00", type: "sight", typeLabel: "æ™¯é»", title: "ç™½è‰²æˆ€äººå…¬åœ’", desc: "æ­é¢¨åº­åœ’é»ç‡ˆ", mapUrl: "https://maps.app.goo.gl/ShiroiKoibito" }
                        ]
                    },
                    {
                        dateStr: "12/27", weekday: "Sat", route: "æœ­å¹Œ (è‡ªç”±/è³¼ç‰©)",
                        temp: "-2Â°C / 1Â°C", weatherIcon: "fa-solid fa-bag-shopping text-pink-400",
                        events: [
                            { id: 81, time: "All Day", type: "sight", typeLabel: "Free", title: "æœ­å¹Œå¸‚å€è‡ªç”±è¡Œ", desc: "è£œè²¨ / ç‹¸å°è·¯ / è³¼ç‰©ä¸­å¿ƒ", mapUrl: "https://maps.app.goo.gl/Tanukikoji", tips: "ç‹¸å°è·¯è—¥å¦åº—æ¿€æˆ°å€ï¼Œè¨˜å¾—æ¯”åƒ¹ã€‚å”å‰è¨¶å¾·åœ¨ç‹¸å°è·¯ 3 ä¸ç›®ã€‚" },
                            { id: 82, time: "12:00", type: "food", typeLabel: "åˆé¤", title: "åŒ—æµ·é“ç¥å®®", desc: "(è‹¥æ˜¨æ—¥æœªå») åƒæ‹œ & å…­èŠ±åˆ¤å®˜é¤…", mapUrl: "https://maps.app.goo.gl/HokkaidoShrine", tips: "ç¥å®®å…§çš„å…­èŠ±äº­èŒ¶å±‹æœ‰è³£ç¾çƒ¤çš„ã€åˆ¤å®˜é¤…ã€ï¼Œä¸€å®šè¦åƒï¼" }
                        ]
                    },
                    {
                        dateStr: "12/28", weekday: "Sun", route: "æœ­å¹Œ â” å°åŒ—",
                        temp: "-1Â°C / 2Â°C", weatherIcon: "fa-solid fa-plane-departure text-gray-500",
                        events: [
                            { id: 91, time: "11:00", type: "transport", typeLabel: "Train", title: "å‰å¾€æ–°åƒæ­²æ©Ÿå ´", desc: "é ç•™æ™‚é–“é€›æ©Ÿå ´åœ‹å…§ç·š", mapUrl: "https://goo.gl/maps/CTS", tips: "æ–°åƒæ­²æ©Ÿå ´åœ‹å…§ç·šè¶…å¥½é€›ï¼æœ‰å“†å•¦Aå¤¢æ¨‚åœ’ã€æ‹‰éºµé“å ´ã€Royceå·§å…‹åŠ›å·¥å» ã€‚å»ºè­°ææ—© 3 å°æ™‚åˆ°ã€‚" },
                            { id: 92, time: "15:20", type: "transport", typeLabel: "Flight", title: "BR115 é£›å¾€å°åŒ—", desc: "CTS -> TPE", mapUrl: "" }
                        ]
                    }
                ],

                init() {
                    // ç›£è½ Firebase è³‡æ–™åº«è®ŠåŒ–
                    const q = query(expensesCol, orderBy("timestamp", "desc"));
                    onSnapshot(q, (snapshot) => {
                        this.expenses = snapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        this.loading = false;
                    });
                },

                get totalExpense() {
                    return this.expenses.reduce((sum, item) => sum + parseInt(item.cost || 0), 0).toLocaleString();
                },

                async addExpense() {
                    if (this.newItemName && this.newItemCost) {
                        await addDoc(expensesCol, {
                            name: this.newItemName,
                            cost: parseInt(this.newItemCost),
                            timestamp: Date.now()
                        });
                        this.newItemName = '';
                        this.newItemCost = '';
                    }
                },

                async removeExpense(id) {
                    if(confirm('ç¢ºå®šåˆªé™¤?')) {
                        await deleteDoc(doc(db, "expenses", id));
                    }
                }
            }));
        });
        
        Alpine.start();
    </script>
</body>
</html>